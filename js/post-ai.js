let animationRunning=!0,explanation=document.querySelector(".ai-explanation"),abstract_value=document.querySelector(".ai-explanation-none").innerHTML,post_ai=document.querySelector(".post-ai"),ai_btn_item=document.querySelectorAll(".ai-btn-item"),ai_str="",ai_str_length="",delay_init=600,i=0,j=0,sto=[],elapsed=0;const animate=e=>{if(animationRunning)if(animate.start||(animate.start=e),elapsed=e-animate.start,elapsed>=20){if(animate.start=e,i<ai_str_length-1){let e=ai_str.charAt(i+1),t=/[,.，。!?！？]/.test(e)?150:20;explanation.firstElementChild&&explanation.removeChild(explanation.firstElementChild),explanation.innerHTML+=e;let a=document.createElement("div");a.className="ai-cursor",explanation.appendChild(a),i++,150===t&&(document.querySelector(".ai-explanation .ai-cursor").style.opacity="0"),i===ai_str_length-1&&(observer.disconnect(),explanation.removeChild(explanation.firstElementChild)),sto[0]=setTimeout((()=>{requestAnimationFrame(animate)}),t)}}else requestAnimationFrame(animate)},observer=new IntersectionObserver((e=>{let t=e[0].isIntersecting;animationRunning=t,animationRunning&&(delay_init=0===i?200:20,sto[1]=setTimeout((()=>{console.log("23452352235"),j&&(i=0,j=0),0===i&&(explanation.innerHTML=ai_str.charAt(0)),requestAnimationFrame(animate)}),delay_init))}),{threshold:0});function clearSTO(){sto.length&&sto.forEach((e=>{e&&clearTimeout(e)}))}function startAI(e,t=!0){i=0,j=1,clearSTO(),animationRunning=!1,elapsed=0,explanation.innerHTML=t?"生成中. . .":"请等待. . .",ai_str=e,ai_str_length=ai_str.length,observer.disconnect(),observer.observe(post_ai)}function aiIntroduce(){startAI("我是文章辅助AI: QX-AI，点击下方的按钮，让我生成本文简介、推荐相关文章等。")}function aiAbstract(){startAI(abstract_value)}function aiRecommend(){i=0,j=1,clearSTO(),animationRunning=!1,elapsed=0,explanation.innerHTML="生成中. . .",ai_str="",ai_str_length="",observer.disconnect(),sto[2]=setTimeout((()=>{explanation.innerHTML=recommendList()}),300)}function aiGoHome(){startAI("正在前往博客主页...",!1),sto[2]=setTimeout((()=>{pjax.loadUrl("/")}),1e3)}function recommendList(){let e="推荐文章：<br />",t=document.querySelectorAll(".card-recommend-post .aside-list .aside-list-item .thumbnail");return t||(e="很抱歉，无法找到类似的文章，你也可以看看本站最新发布的文章：<br />",t=document.querySelectorAll(".card-recent-post .aside-list .aside-list-item .thumbnail")),e+='<div class="ai-recommend">',t.forEach(((t,i)=>{e+=`<div class="ai-recommend-item"><span>推荐${i+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${t.href}')" title="${t.title}" data-pjax-state="">${t.title}</a></div>`})),e+="</div>",e}function ai_init(){explanation=document.querySelector(".ai-explanation"),abstract_value=document.querySelector(".ai-explanation-none").innerHTML,post_ai=document.querySelector(".post-ai"),ai_btn_item=document.querySelectorAll(".ai-btn-item"),ai_btn_item.forEach(((e,t)=>{e.addEventListener("click",(()=>{switch(t){case 0:aiIntroduce();break;case 1:aiAbstract();break;case 2:aiRecommend();break;case 3:aiGoHome()}}))})),aiIntroduce()}ai_init(),document.addEventListener("pjax:complete",(function(){ai_init()}));