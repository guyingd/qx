function allAI(){let e=!0,t=document.querySelector(".ai-explanation"),n=document.querySelector(".ai-explanation-none").innerHTML,o=document.querySelector(".post-ai"),i=document.querySelectorAll(".ai-btn-item"),a="",r="",s=600,c=0,l=0,u=[],m=0,d=!1,f=new AbortController,p=f.signal;const h="填入chatGPT的apiKey",y="https://www.qcqx.cn/",T="tN2jLmG7fX9zHk5dVbQr",g=n=>{if(e)if(g.start||(g.start=n),m=n-g.start,m>=20){if(g.start=n,c<r-1){let e=a.charAt(c+1),n=/[,.，。!?！？]/.test(e)?150:20;t.firstElementChild&&t.removeChild(t.firstElementChild),t.innerHTML+=e;let o=document.createElement("div");o.className="ai-cursor",t.appendChild(o),c++,150===n&&(document.querySelector(".ai-explanation .ai-cursor").style.opacity="0"),c===r-1&&(b.disconnect(),t.removeChild(t.firstElementChild)),u[0]=setTimeout((()=>{requestAnimationFrame(g)}),n)}}else requestAnimationFrame(g)},b=new IntersectionObserver((n=>{let o=n[0].isIntersecting;e=o,e&&(s=0===c?200:20,u[1]=setTimeout((()=>{l&&(c=0,l=0),0===c&&(t.innerHTML=a.charAt(0)),requestAnimationFrame(g)}),s))}),{threshold:0});function A(n=!0){c=0,l=1,u.length&&u.forEach((e=>{e&&clearTimeout(e)})),e=!1,m=0,t.innerHTML=n?"生成中. . .":"请等待. . .",d||f.abort(),a="",r="",b.disconnect()}function S(e,t=!0){A(t),a=e,r=a.length,b.observe(o)}function q(){S("我是文章辅助AI: QX-AI，点击下方的按钮，让我生成本文简介、推荐相关文章等。")}function w(){S(n)}function E(){A(),u[2]=setTimeout((()=>{t.innerHTML=function(){let e="推荐文章：<br />",t=document.querySelectorAll(".card-recommend-post .aside-list .aside-list-item .thumbnail");t||(e="很抱歉，无法找到类似的文章，你也可以看看本站最近更新的文章：<br />",t=document.querySelectorAll(".card-recent-post .aside-list .aside-list-item .thumbnail"));return e+='<div class="ai-recommend">',t.forEach(((t,n)=>{e+=`<div class="ai-recommend-item"><span>推荐${n+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${t.href}')" title="${t.title}" data-pjax-state="">${t.title}</a></div>`})),e+="</div>",e}()}),300)}async function v(){if(function(e=3e3){let t=Date.now()-localStorage.getItem("aiTime");return t<e&&(btf.snackbarShow(3-parseInt(t/1e3)+"后才能再次点击真AI简介"),!0)}())return;localStorage.setItem("aiTime",Date.now()),A();const e=C(document.querySelector("#article-container"));console.log(e);const t=await async function(e,t=!0){if(d=!1,f=new AbortController,p=f.signal,t){const t=await fetch("https://summary.tianli0.top/",{signal:p,method:"POST",headers:{"Content-Type":"application/json",Referer:y},body:JSON.stringify({content:e,key:T})});429===t.status&&S("请求过于频繁，请稍后再请求AI。");const n=(await t.json()).summary;return d=!0,n}{const t=`你是一个摘要生成工具，你需要解释我发送给你的内容，不要换行，不要超过200字，只需要介绍文章的内容，不需要提出建议和缺少的东西。请用中文回答，文章内容为：${e}`,n="https://api.openai.com/v1/chat/completions",o=await fetch(n,{signal:p,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:t}]})});429===o.status&&S("请求过于频繁，请稍后再请求AI。");const i=(await o.json()).choices[0].message.content;return d=!0,i}}(e,true);console.log(t),S(t)}function C(e){const t=["highlight","Copyright-Notice","post-ai","post-series","mini-sandbox"];let n="";for(let o of e.childNodes)if(o.nodeType===Node.TEXT_NODE)n+=o.textContent.trim();else if(o.nodeType===Node.ELEMENT_NODE){let e=!1;for(let n of o.classList)if(t.includes(n)){e=!0;break}if(!e){let e=C(o);n&&e?/[：:,.，。?？/；;!！（）、)(]$/.test(n)||/^[：:,.，。?？/；;!！（）、@#￥$%&)(]/.test(e)?n+=e:n+="。"+e:n+=e}}return n.replace(/\s+/g,"")}!function(){t=document.querySelector(".ai-explanation"),n=document.querySelector(".ai-explanation-none").innerHTML,o=document.querySelector(".post-ai"),i=document.querySelectorAll(".ai-btn-item");const e=[q,w,E,v];i.forEach(((t,n)=>{t.addEventListener("click",(()=>{e[n]()}))})),q()}()}allAI();